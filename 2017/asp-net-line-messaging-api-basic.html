<!DOCTYPE html><html lang="zh-TW"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>以 ASP.NET Web API 開發 LINE BOT - LINE Messaging API 詳解 | 想不起來而已</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">以 ASP.NET Web API 開發 LINE BOT - LINE Messaging API 詳解</h1><a id="logo" href="/.">想不起來而已</a><p class="description">浪漫工頭的麵包屑</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 所有文章</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">以 ASP.NET Web API 開發 LINE BOT - LINE Messaging API 詳解</h1><div class="post-meta">Aug 15, 2017<span> | </span><span class="category"><a href="/categories/construction/">軟體構建</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/asp-net-line-messaging-api-basic.html" href="/2017/asp-net-line-messaging-api-basic.html#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p><img src="http://farm5.static.flickr.com/4314/35819844020_e8b641880d_b.jpg" alt="LINE"></p>
<h3 id="BOT-應用正持續發展中，金融、線上購物、計程車叫車等很多領域都已提供商用服務，現在就來學習-LINE-BOT-開發。"><a href="#BOT-應用正持續發展中，金融、線上購物、計程車叫車等很多領域都已提供商用服務，現在就來學習-LINE-BOT-開發。" class="headerlink" title="BOT 應用正持續發展中，金融、線上購物、計程車叫車等很多領域都已提供商用服務，現在就來學習 LINE BOT 開發。"></a>BOT 應用正持續發展中，金融、線上購物、計程車叫車等很多領域都已提供商用服務，現在就來學習 LINE BOT 開發。</h3><p>從 2016 起，Facebook、Microsoft 等大廠都提供了聊天機器人 bot 的相關方案，在台灣使用度極高的 LINE 也在 2016 上半年提供 BOT API。LINE 繼一開始的 LINE BOT API 後，又在 2016 年底推出了新版的 API 叫 Messaging API，而原本的 BOT API 則已標示棄用。</p>
<a id="more"></a>
<h2 id="LINE-Messaging-API-簡介"><a href="#LINE-Messaging-API-簡介" class="headerlink" title="LINE Messaging API 簡介"></a>LINE Messaging API 簡介</h2><p>LINE 將 BOT API 改為 Messaging API 是明確合理的。因為有了 bot 這個名稱後會讓人想到它有提供語意分析或其它 AI 功能，但它沒有。它單純提供訊息對談的串接，訊息接收後的處理及回應，都由開發的服務負責。</p>
<h3 id="基本架構及資料流程"><a href="#基本架構及資料流程" class="headerlink" title="基本架構及資料流程"></a>基本架構及資料流程</h3><p>服務提供者可透過 Messaging API 將自己的服務內容串聯到 LINE@ 上。對這個 LINE@ 的好友來說，即可透過 LINE 聊天介面與該 LINE@ 帳號後的服務進行雙向互動，並操作各式服務提供者做好的線上服務，享用完整、一致的使用者體驗。</p>
<p>如下圖：</p>
<p><img src="https://scdn.line-apps.com/n/_5/partner-center/img/lp/msgapi-figure1.png" alt="架構"></p>
<p>Service 和 Messaging API 間以 HTTPS POST 交換 JSON 資料的方式做串接，簡單講就是字串來字串回，所以可利用各種 Web 技術實作 Messaging Service，Service 的網址就叫 WebHook。對 .NET 的開發者來說，最合適的技術就是 <code>ASP.NET Web API</code>。</p>
<h3 id="Messaging-API-的三大功能"><a href="#Messaging-API-的三大功能" class="headerlink" title="Messaging API 的三大功能"></a>Messaging API 的三大功能</h3><h4 id="可加入群組聊天"><a href="#可加入群組聊天" class="headerlink" title="可加入群組聊天"></a>可加入群組聊天</h4><p>串聯 Messaging API 的 LINE@ 帳號(聊天機器人) 可以被好友邀請至私人 LINE 聊天群組中，群組中的好友們即可與該機器人對話互動，在聊天室中直接完成例如景點推薦或餐廳查詢訂位等服務。</p>
<p><img src="http://lineat.blogimg.jp/tw/imgs/7/8/7832cf12-s.png" alt="群組聊天"></p>
<h4 id="多樣的訊息格式"><a href="#多樣的訊息格式" class="headerlink" title="多樣的訊息格式"></a>多樣的訊息格式</h4><p>除了基本的文字及圖片影片對話外，Messaging API 還提供多樣的訊息格式：</p>
<ul>
<li>確認 - Confirm</li>
<li>按鍵 - Button</li>
<li>橫向捲軸 - Carousel</li>
<li>影像地圖 - Imagemap</li>
</ul>
<p>在好友與服務的互動過程中，透過這些訊息格式將可更精確地獲知好友的需求，讓訊息溝通更視覺化也更加順暢。</p>
<p><img src="http://lineat.blogimg.jp/tw/imgs/e/c/ec97c9f7-s.png" alt="訊息格式"></p>
<h4 id="Push-API-與-Reply-API"><a href="#Push-API-與-Reply-API" class="headerlink" title="Push API 與 Reply API"></a>Push API 與 Reply API</h4><p>Messaging API 提供 Push 與 Reply 兩種傳送訊息給好友的 API：</p>
<ul>
<li>Push API：可以利用 UserId 在任何時間點對好友傳送訊息 - 主動通知</li>
<li>Reply API：針對 LINE 好友傳來的訊息進行回覆，不用先儲存 UserId - 被動回覆</li>
</ul>
<p><img src="http://lineat.blogimg.jp/tw/imgs/d/7/d7bdff20-s.png" alt="Push API 與 Reply API"></p>
<h2 id="環境準備"><a href="#環境準備" class="headerlink" title="環境準備"></a>環境準備</h2><h3 id="申請帳號"><a href="#申請帳號" class="headerlink" title="申請帳號"></a>申請帳號</h3><h4 id="Messaging-API-或-Developer-Trial"><a href="#Messaging-API-或-Developer-Trial" class="headerlink" title="Messaging API 或 Developer Trial"></a>Messaging API 或 Developer Trial</h4><p>進到 LINE BUSINESS CENTER 的 <a href="https://business.line.me/zh-hant/services/bot" title="messaging api home" target="_blank" rel="external">Messaging API</a> 專頁，最上面就是 Messaging API 或 Developer Trial 的申請入口，在這裡要2選1，決定申請的 API 方案類型：Messaging API 是正式服務的方案組合；Developer Trial 是開發者方案，申請的 LINE@ 帳號一旦綁定，就不能更換。<br>Messaging API 有多種費用方案 Developer Trial 則是免費但好友上限為50人，在同為免費的條件下，Messaging API 不能使用 Push API，所以建議，開發測試時請選用 Developer Trial 方案。</p>
<h4 id="申請-Developer-Trial-帳號"><a href="#申請-Developer-Trial-帳號" class="headerlink" title="申請 Developer Trial 帳號"></a>申請 Developer Trial 帳號</h4><p>請參考官方部落格說明 - <a href="http://at-blog.line.me/tw/create_developer_trial" title="create developer trial" target="_blank" rel="external">【功能介紹】申請Developer Trial帳號</a></p>
<h4 id="啟用-Webhook-傳訊"><a href="#啟用-Webhook-傳訊" class="headerlink" title="啟用 Webhook 傳訊"></a>啟用 Webhook 傳訊</h4><p>Webhook URL 即是自行開發的 Messaging Service 的網址，要啟用 Webhook 傳訊功能，好友的訊息才會串到我們的服務：</p>
<ul>
<li>Bot設定 中，將 Webhooko傳訊 設為 <code>允許</code></li>
<li>開發者頁面第一個選項 <code>Basic information</code> 中設定 Webhook URL</li>
</ul>
<p>注意，Webhook URL 必須是走 <strong>https 的對外開放網址</strong>，所以選擇適當主機來發佈服務很重要，對 .NET 開發者來說最簡單的方式應該是丟上 Azure，但支援 SSL 的方案是要收費的；不然就是自行架設主機並申請像是 <a href="https://letsencrypt.org/" title="Let&#39;s Encrypt" target="_blank" rel="external">Let’s Encrypt</a> 的免費憑證來用。</p>
<h4 id="取得-Channel-Secret-及-Channel-Token"><a href="#取得-Channel-Secret-及-Channel-Token" class="headerlink" title="取得 Channel Secret 及 Channel Token"></a>取得 Channel Secret 及 Channel Token</h4><p>從開發者頁面中記錄下 Channel Secret 及 Channel Token，之後要設定在程式中做為資料驗證及訊息發送之用。</p>
<h3 id="SDK：專案代碼-line-bot-sdk-csharp"><a href="#SDK：專案代碼-line-bot-sdk-csharp" class="headerlink" title="SDK：專案代碼 line-bot-sdk-csharp"></a>SDK：專案代碼 line-bot-sdk-csharp</h3><p>Messaging API 是以 JSON 格式做資料交互，官方現在有提供七種程式語言的 SDK 方便開發者使用。</p>
<p><strong>但是沒有 .NET 版本！</strong>  </p>
<p>.NET 開發者只能自立自強。</p>
<p>所幸 NuGet 上有數個程式庫提供 LINE bot SDK，這裡我選用了 line-bot-sdk-csharp 這個庫，原因是它 open source 並有提供 Visual Studio 的專案範本，可以直接用來建立專案或是當作文件參考，其它有些專案都沒有文件或範例，要自己花點時間了解。</p>
<ul>
<li>專案：<a href="https://github.com/kenakamu/line-bot-sdk-csharp" title="line-bot-sdk-csharp" target="_blank" rel="external">line-bot-sdk-csharp</a></li>
<li>範本：<a href="https://github.com/kenakamu/line-bot-sdk-csharp/releases/tag/LineBotApplicationv1.3" title="Line Bot Application" target="_blank" rel="external">Line Bot Application</a></li>
</ul>
<h3 id="準備專案"><a href="#準備專案" class="headerlink" title="準備專案"></a>準備專案</h3><p>這裡會手動建立一個最基本的 Web API 專案來做示範。<br>也可利用 Web API 專案範本以加速專案的建立，但專案會比較肥一些。</p>
<h4 id="建立空白-Web-專案"><a href="#建立空白-Web-專案" class="headerlink" title="建立空白 Web 專案"></a>建立空白 Web 專案</h4><p>開啟 Visual Studio 2015，新增專案，選擇 <code>ASP.NET Web Application (.NET Framework)</code>，選擇 <code>空白</code>，確定後建立專案。</p>
<h4 id="加入-Web-API-功能"><a href="#加入-Web-API-功能" class="headerlink" title="加入 Web API 功能"></a>加入 Web API 功能</h4><p>在 套件管理器主控台 新增以下套件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Install-Package Microsoft.Owin.Host.SystemWeb</div><div class="line">Install-Package Microsoft.AspNet.WebApi.Owin</div></pre></td></tr></table></figure></p>
<h4 id="啟用-Web-API"><a href="#啟用-Web-API" class="headerlink" title="啟用 Web API"></a>啟用 Web API</h4><p>加入 <code>OWIN 啟動類別</code>，增加以下內容以啟用 Web API<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Startup</div><div class="line">&#123;</div><div class="line">    public void Configuration(IAppBuilder app)</div><div class="line">    &#123;</div><div class="line">        // Wire Web API</div><div class="line">        var httpConfiguration = new HttpConfiguration();</div><div class="line">        httpConfiguration.MapHttpAttributeRoutes();</div><div class="line"></div><div class="line">        app.UseWebApi(httpConfiguration);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="建立-Controller-及-Action"><a href="#建立-Controller-及-Action" class="headerlink" title="建立 Controller 及 Action"></a>建立 Controller 及 Action</h4><p>新增 <code>Controllers</code> 目錄，在目錄下加入 <code>控制器</code> 選擇 <code>Web API 2 控制器 - 空白</code>，可取名<br>LineMessagesSampleController</p>
<p>在 class 上加上 <code>[RoutePrefix(&quot;line&quot;)]</code> 指定 route 路徑名稱為 “line”。再加上 <code>Post</code> action 來處理 LINE Server 的呼叫，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[RoutePrefix(&quot;line&quot;)]</div><div class="line">public class LineMessagesSampleController : ApiController</div><div class="line">&#123;</div><div class="line">    [Route]</div><div class="line">    public async Task&lt;HttpResponseMessage&gt; Post(HttpRequestMessage request)</div><div class="line">    &#123;</div><div class="line">        return Request.CreateResponse(HttpStatusCode.OK, &quot;Hello LINE BOT&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>對 <a href="http://localhost:[port]/line" target="_blank" rel="external">http://localhost:[port]/line</a> 做 POST 測試以確認它可以正常執行。</p>
<h4 id="安裝-line-bot-sdk-csharp-套件"><a href="#安裝-line-bot-sdk-csharp-套件" class="headerlink" title="安裝 line-bot-sdk-csharp 套件"></a>安裝 line-bot-sdk-csharp 套件</h4><p>在 套件管理器主控台 新增以下套件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Install-Package LineMessagingAPI.CSharp</div></pre></td></tr></table></figure></p>
<h2 id="Messaging-API-的基礎"><a href="#Messaging-API-的基礎" class="headerlink" title="Messaging API 的基礎"></a>Messaging API 的基礎</h2><p>官方文件：<a href="https://devdocs.line.me/en/#messaging-api" title="messaging api reference" target="_blank" rel="external">Messaging API Reference</a>。<br>文件中有各種訊息的 JSON 範例及官方 SDK 使用說明，很重要。</p>
<h3 id="接收使用者活動訊息並做回應"><a href="#接收使用者活動訊息並做回應" class="headerlink" title="接收使用者活動訊息並做回應"></a>接收使用者活動訊息並做回應</h3><p>當有人對 LINE@ 帳號做操作時，如加為好友或傳送訊息，就會收到一串 POST 過來的 JSON 內容。<br>LINE 可能會在一組訊息中送來多個 event 資訊，所以用陣列方式表達，後續就是取得裡面的 events 做處理。</p>
<p>透過 SDK 把 request 的內容轉為 <code>Activity</code> 物件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var content = await request.Content.ReadAsStringAsync();</div><div class="line">Activity activity = JsonConvert.DeserializeObject&lt;Activity&gt;(content);</div></pre></td></tr></table></figure></p>
<p>request 原始內容範例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;events&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;replyToken&quot;: &quot;nHuyWiB7yP5Zw52FIkcQobQuGDXCTA&quot;,</div><div class="line">        &quot;type&quot;: &quot;message&quot;,</div><div class="line">        &quot;timestamp&quot;: 1462629479859,</div><div class="line">        &quot;source&quot;: &#123;</div><div class="line">             &quot;type&quot;: &quot;user&quot;,</div><div class="line">             &quot;userId&quot;: &quot;U206d25c2ea6bd87c17655609a1c37cb8&quot;</div><div class="line">         &#125;,</div><div class="line">         &quot;message&quot;: &#123;</div><div class="line">             &quot;id&quot;: &quot;325708&quot;,</div><div class="line">             &quot;type&quot;: &quot;text&quot;,</div><div class="line">             &quot;text&quot;: &quot;Hello, world&quot;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="驗證內容"><a href="#驗證內容" class="headerlink" title="驗證內容"></a>驗證內容</h3><p>在正式處理前，可以對 POST 過來的資料做驗證，確定真的是由 LINE 平台所丟來的。</p>
<p>LINE 會在 http header 寫入 <code>X-LINE-ChannelSignature</code> ，用收到的 request 內容用 Channel Secret 做雜湊，比較兩個值是否一樣，就可以驗證內容是否真的來自於 LINE 平台。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var hmac = new HMACSHA256(Encoding.UTF8.GetBytes([ChannelSecret]));</div><div class="line">var computeHash = hmac.ComputeHash(Encoding.UTF8.GetBytes(await request.Content.ReadAsStringAsync()));</div><div class="line">var contentHash = Convert.ToBase64String(computeHash);</div><div class="line">var headerHash = Request.Headers.GetValues(&quot;X-Line-Signature&quot;).First();</div><div class="line"></div><div class="line">return contentHash == headerHash;</div></pre></td></tr></table></figure>
<h2 id="對送來的-Events-做處理"><a href="#對送來的-Events-做處理" class="headerlink" title="對送來的 Events 做處理"></a>對送來的 Events 做處理</h2><h3 id="建立-LineClient"><a href="#建立-LineClient" class="headerlink" title="建立 LineClient"></a>建立 LineClient</h3><p>SDK 提供 <code>LineClient</code> 這個類別方便和 Line 平台做交互。發送時要配合送出 Channel Token 以取信於 LINE。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private LineClient lineClient = new LineClient([ChannelToken]);</div></pre></td></tr></table></figure>
<h3 id="取得好友資訊"><a href="#取得好友資訊" class="headerlink" title="取得好友資訊"></a>取得好友資訊</h3><p>從每個 event 中的 Source 屬性可以取得好友的 UserId。透過 SDK 可以用 UserId 跟 LINE 平台取得好友的基本資料。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Profile profile = await lineClient.GetProfile(lineEvent.Source.UserId);</div></pre></td></tr></table></figure>
<p>當透過群組或聊天室傳訊過來，source 的類型可以是 room 或 group，可透過 <code>lineEvent.Source.RoomId</code> 及<code>lineEvent.Source.GroupId</code> 取得 Id。</p>
<p>如果有發送 Push message 的需求，要把 UserId 儲存起來才能在要發送時拿出來用。</p>
<h3 id="依-lineEvent-Type-對-event-做處理"><a href="#依-lineEvent-Type-對-event-做處理" class="headerlink" title="依 lineEvent.Type 對 event 做處理"></a>依 lineEvent.Type 對 event 做處理</h3><p>event 有 7 種類型，Message event 是使用者輸入的內容，其它 6 種則是使用者行為，我稱為 Action event，收到 event 後可以做後續處理再回 Message 給好友。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">foreach (Event lineEvent in activity.Events)</div><div class="line">&#123;</div><div class="line">    Profile profile = await lineClient.GetProfile(lineEvent.Source.UserId);</div><div class="line"></div><div class="line">    switch (lineEvent.Type)</div><div class="line">    &#123;</div><div class="line">        case EventType.XXXXX:</div><div class="line">        // HandleXXXXXEvent</div><div class="line">        break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Message-event-的處理"><a href="#Message-event-的處理" class="headerlink" title="Message event 的處理"></a>Message event 的處理</h2><p>好友可以傳送 7 種類型的 message：Text、Image、Video、Audio、File、Location、Sticker，就是我們在　LINE App 中可以傳的內容。<br>程式中取得 message 內容後透過 SDK 先轉為 <code>Message</code> 物件做類型判斷。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">case EventType.Message:</div><div class="line">    Message message = JsonConvert.DeserializeObject&lt;Message&gt;(lineEvent.Message.ToString());</div><div class="line"></div><div class="line">    switch (message.Type)</div><div class="line">    &#123;</div><div class="line">        ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="Text-一般文字內容"><a href="#Text-一般文字內容" class="headerlink" title="Text - 一般文字內容"></a>Text - 一般文字內容</h3><p>透過 SDK 將 message 內容轉為 <code>TextMessage</code> 物件後取 <code>Text</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">case MessageType.Text:</div><div class="line">    var textMessage = JsonConvert.DeserializeObject&lt;TextMessage&gt;(lineEvent.Message.ToString());</div><div class="line">    var content = textMessage.Text;</div><div class="line">    ...(產生 replyMessage)...</div><div class="line">    Reply(replyMessage);</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Audio-Image-Video-多媒體內容"><a href="#Audio-Image-Video-多媒體內容" class="headerlink" title="Audio,Image,Video - 多媒體內容"></a>Audio,Image,Video - 多媒體內容</h3><p>依 <code>Message</code> 的 message.Id，透過 lineClient 從 LINE server 取得內容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">case MessageType.Audio:</div><div class="line">case MessageType.Image:</div><div class="line">case MessageType.Video:</div><div class="line">    // Get media from Line server.</div><div class="line">    Media media = await lineClient.GetContent(message.Id);</div><div class="line">    ...(產生 replyMessage)...</div><div class="line">    Reply(replyMessage);</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Sticker-貼圖"><a href="#Sticker-貼圖" class="headerlink" title="Sticker - 貼圖"></a>Sticker - 貼圖</h3><p>透過 SDK 將 message 內容轉為 <code>StickerMessage</code> 物件，就可取得該圖所屬的圖庫和在圖庫裡的序號。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">case MessageType.Sticker:</div><div class="line">    // Get media from Line server.</div><div class="line">    var stickerMessage = JsonConvert.DeserializeObject&lt;StickerMessage&gt;(lineEvent.Message.ToString());</div><div class="line">    ...(產生 replyMessage)...</div><div class="line">    Reply(replyMessage);</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Location-位置"><a href="#Location-位置" class="headerlink" title="Location - 位置"></a>Location - 位置</h3><p>透過 SDK 將 message 內容轉為 <code>LocationMessage</code> 物件，就可取得名稱、地址、經緯度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">case MessageType.Location:</div><div class="line">    var locationMessage = JsonConvert.DeserializeObject&lt;LocationMessage&gt;(lineEvent.Message.ToString());</div><div class="line">    var latitude = locationMessage.Latitude;</div><div class="line">    var longitude = locationMessage.Longitude;</div><div class="line">    ...(產生 replyMessage)...</div><div class="line">    Reply(replyMessage);</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h2 id="傳送-Message-給好友"><a href="#傳送-Message-給好友" class="headerlink" title="傳送 Message 給好友"></a>傳送 Message 給好友</h2><p>BOT 能傳送給好友的訊息分為 3 種。</p>
<ul>
<li>第 1 種是單純的內容，就跟從好友收到的一樣，包含 Text、Image、Video、Audio、Location、Sticker。</li>
<li>第 2 種是 Imagemap message，跟網頁上的 image map 一樣，可在一張圖片上定義不同區域被點擊後的行為。</li>
<li>第 3 種是 Template messages，已經有預先定義好幾個不同格式及作用 UI 範本，可以做比較好的互動以提供商務應用，現在有 Buttons、Confirm、Carousel 3 種。</li>
</ul>
<h3 id="Text-message"><a href="#Text-message" class="headerlink" title="Text message"></a>Text message</h3><p>文字訊息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">replyMessage = new TextMessage([Text]);</div></pre></td></tr></table></figure></p>
<h3 id="Media-Image、Video、Audio-message"><a href="#Media-Image、Video、Audio-message" class="headerlink" title="Media (Image、Video、Audio) message"></a>Media (Image、Video、Audio) message</h3><p>多媒體訊息產生方式都一樣，建立 Message 物件時傳入素材的網址及預覽圖的網址。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">replyMessage = new ImageMessage(&quot;https://github.com/apple-touch-icon.png&quot;, &quot;https://github.com/apple-touch-icon.png&quot;);</div></pre></td></tr></table></figure></p>
<h3 id="Location-message"><a href="#Location-message" class="headerlink" title="Location message"></a>Location message</h3><p>位置訊息，傳入位置相關資訊<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var replyMessage = new LocationMessage(Title, Address, Latitude, Longitude);</div></pre></td></tr></table></figure></p>
<h3 id="Sticker-message"><a href="#Sticker-message" class="headerlink" title="Sticker message"></a>Sticker message</h3><p>貼圖訊息，傳入圖庫和圖庫中圖的識別號。  </p>
<p>目前 BOT 可以用的貼圖是有限的幾組，不是好友傳什麼我們就可以回什麼，要參考官方文件：<a href="https://devdocs.line.me/files/sticker_list.pdf" title="sticker list" target="_blank" rel="external">sticker-list</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var replyMessage = new StickerMessage(&quot;1&quot;, &quot;2&quot;);</div></pre></td></tr></table></figure></p>
<p>1 是圖庫識別號，2 是圖的識別號。</p>
<h3 id="Imagemap-message"><a href="#Imagemap-message" class="headerlink" title="Imagemap message"></a>Imagemap message</h3><h4 id="Base-URL"><a href="#Base-URL" class="headerlink" title="Base URL"></a>Base URL</h4><p>由於設備的螢幕有大有小，所以要有不同尺寸的圖片。在 ImageMapMessage，要把圖片的目錄指定到 baseUrl 參數中，當中必須要有寬度為 240px, 300px, 460px, 700px, 1040px 的圖片。  </p>
<p>舉例來說，如果 base URL 是 <a href="https://example.com/images/cats，則" target="_blank" rel="external">https://example.com/images/cats，則</a> App 會試著用 <a href="https://example.com/images/cats/700" target="_blank" rel="external">https://example.com/images/cats/700</a> 去下載 700px 的圖片。</p>
<p><strong>請注意，很重要</strong>：<br>圖片的檔名只用尺寸的數字，不要有附檔名，格式只能是 png 或 jpg。<br>例如說，尺寸為 700 的 png 檔，就命名為 700，不是 700.png，LINE 只會用 ~/700 做網址去下載 700px 的圖片。</p>
<h4 id="message-的建立"><a href="#message-的建立" class="headerlink" title="message 的建立"></a>message 的建立</h4><p>設定完一至多個  <code>ImageMapAction</code> 的區域屬性，傳入 <code>ImageMapMessage</code> 後就可以完成設定。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 用 action 建立 2 個 區域</div><div class="line">List&lt;ImageMapAction&gt; actions = new List&lt;ImageMapAction&gt;();</div><div class="line">actions.Add(new UriImageMapAction(&quot;http://github.com&quot;, new ImageMapArea(0, 0, 520, 1040)));</div><div class="line">actions.Add(new MessageImageMapAction(&quot;I love LINE!&quot;, new ImageMapArea(520, 0, 520, 1040)));</div><div class="line">// 建立 message</div><div class="line">replyMessage = new ImageMapMessage(imageUrl, &quot;GitHub&quot;, new BaseSize(1040, 1040), actions);</div></pre></td></tr></table></figure></p>
<p>範例中設了 2 個 Action，圖的上半由 <code>UriImageMapAction</code> 定義，點了之後會開啟到 GitHub 的連結，下面由 <code>MessageImageMapAction</code> 定義的部份則是回覆 “I love LINE!” 的訊息。</p>
<h3 id="Template-message-的-SDK-使用方式"><a href="#Template-message-的-SDK-使用方式" class="headerlink" title="Template message 的 SDK 使用方式"></a>Template message 的 SDK 使用方式</h3><p>要建立 Template message，至少要透過三層物件，Carousel 還多了一層 Column：</p>
<ul>
<li>Action：首先要定義 actions，設定呈現給好友的行為及內容。</li>
<li>Template：將 actions 加入特定類型的 Template 物件並設定一些屬性。</li>
<li>Message：統一為建立 <code>TemplateMessage</code>。 </li>
</ul>
<h3 id="Confirm-Template-message"><a href="#Confirm-Template-message" class="headerlink" title="Confirm Template message"></a>Confirm Template message</h3><p>Confirm Template 會產生一個 2 個選項 Action 的確認對話框，讓好友選擇 Yes/No 或 OK/Cancel 之類的回答。Action 中的顯示文字和回答內容是我們可以指定的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// Actions</div><div class="line">List&lt;TemplateAction&gt; actions = new List&lt;TemplateAction&gt;();</div><div class="line">actions.Add(new MessageTemplateAction(&quot;OK&quot;, &quot;ok&quot;));</div><div class="line">actions.Add(new MessageTemplateAction(&quot;Cancel&quot;, &quot;cancel&quot;));</div><div class="line">// Template</div><div class="line">ConfirmTemplate confirmTemplate = new ConfirmTemplate(&quot;Are you sure?&quot;, actions);</div><div class="line">// Message</div><div class="line">replyMessage = new TemplateMessage(&quot;this is a confirm template&quot;, confirmTemplate);</div></pre></td></tr></table></figure>
<p>利用 <code>MessageTemplateAction(label, text)</code> 建立選項，當好友點選 MessageTemplateAction，LINE 系統就會幫好友在聊天室中輸入 text 參數的內容並送出，就像好友自己打的訊息一樣，然後 BOT 可以針對這個內容做後續處理後再回應。</p>
<p><img src="https://devdocs.line.me/images/confirm.png" alt="confirm"></p>
<h3 id="Buttons-Template-message"><a href="#Buttons-Template-message" class="headerlink" title="Buttons Template message"></a>Buttons Template message</h3><p>Buttons Template 會呈現圖、文及 1-4 個選項的畫面，可以和好友做清楚溝通後讓好友做選擇。</p>
<p>選項 Action 有三種類型可用：</p>
<ul>
<li>MessageTemplateAction：就像前述的，幫好友送出指定訊息，並做後續處理。</li>
<li>UriTemplateAction：直接在 LINE 裡開啟指定的網頁，參數 1 為顯示文字，參數 2 為網址。</li>
<li>PostbackTemplateAction：直接發送設定好的內容 (postback data) 給 BOT，但不呈現在聊天室的對話中。可以透過對 Postback event 的處理來取得內容。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Actions</div><div class="line">List&lt;TemplateAction&gt; actions = new List&lt;TemplateAction&gt;();</div><div class="line">actions.Add(new MessageTemplateAction(&quot;Message Label&quot;, &quot;sample data&quot;));</div><div class="line">actions.Add(new PostbackTemplateAction(&quot;Postback Label&quot;, &quot;postback data&quot;, &quot;postback text&quot;));</div><div class="line">actions.Add(new UriTemplateAction(&quot;Uri Label&quot;, &quot;https://github.com/kenakamu&quot;));</div><div class="line">// Template</div><div class="line">ButtonsTemplate buttonsTemplate = new ButtonsTemplate(&quot;https://github.com/apple-touch-icon.png&quot;, &quot;Sample Title&quot;, &quot;Sample Text&quot;, actions);</div><div class="line">// Message</div><div class="line">replyMessage = new TemplateMessage(&quot;Buttons&quot;, buttonsTemplate);</div></pre></td></tr></table></figure>
<p><code>ButtonsTemplate</code> 可以設定圖片、標題、說明及選項 4 個參數，不需要的參數輸入 null 即可。</p>
<p><img src="https://devdocs.line.me/images/buttons.png" alt="buttons"></p>
<h3 id="Carousel-Template-message"><a href="#Carousel-Template-message" class="headerlink" title="Carousel Template message"></a>Carousel Template message</h3><p>Carousel Template 就是多個 Buttons Template message 橫著擺可以左右划，以呈現比較多的商品或主題選項。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">List&lt;TemplateColumn&gt; columns = new List&lt;TemplateColumn&gt;();</div><div class="line">List&lt;TemplateAction&gt; actions = new List&lt;TemplateAction&gt;();</div><div class="line">// Action</div><div class="line">actions.Add(new MessageTemplateAction(&quot;Message Label&quot;, &quot;sample data&quot;));</div><div class="line">actions.Add(new PostbackTemplateAction(&quot;Postback Label&quot;, &quot;postback data&quot;, &quot;postback text&quot;));</div><div class="line">actions.Add(new UriTemplateAction(&quot;Uri Label&quot;, &quot;https://github.com/kenakamu&quot;));</div><div class="line">// Column</div><div class="line">columns.Add(new TemplateColumn() &#123; Title = &quot;Casousel 1 Title&quot;, Text = &quot;Casousel 1 Text&quot;, ThumbnailImageUrl = &quot;https://github.com/apple-touch-icon.png&quot;, Actions = actions &#125;);</div><div class="line">columns.Add(new TemplateColumn() &#123; Title = &quot;Casousel 2 Title&quot;, Text = &quot;Casousel 2 Text&quot;, ThumbnailImageUrl = &quot;https://github.com/apple-touch-icon.png&quot;, Actions = actions &#125;);</div><div class="line">// Template</div><div class="line">CarouselTemplate carouselTemplate = new CarouselTemplate(columns);</div><div class="line">// Message</div><div class="line">replyMessage = new TemplateMessage(&quot;Carousel&quot;, carouselTemplate);</div></pre></td></tr></table></figure></p>
<p>把原本的 <code>ButtonsTemplate</code> 改成 <code>TemplateColumn</code> 即是。</p>
<p><img src="https://devdocs.line.me/images/carousel.png" alt="carousel"></p>
<h3 id="發送訊息"><a href="#發送訊息" class="headerlink" title="發送訊息"></a>發送訊息</h3><p>有 2 種發送訊息的模式，Reply message 及 Push message。  </p>
<p>當收到好友主動發來的訊息後，可以利用 Reply message API 來做回覆。回覆時，要帶原本訊息中的 replyToken 回去做驗證，replyToken 是有時限且只能用一次，要儘快回覆。</p>
<p>BOT 可以透過 Push message API 主動發訊息給指定 UserId 的好友，但能不能使用這個方式發送要看選用的方案。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">try</div><div class="line">&#123;</div><div class="line">    await lineClient.ReplyToActivityAsync(lineEvent.CreateReply(message: replyMessage));</div><div class="line">&#125;</div><div class="line">catch</div><div class="line">&#123;</div><div class="line">    await lineClient.PushAsync(lineEvent.CreatePush(message: replyMessage));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Action-event-的處理"><a href="#Action-event-的處理" class="headerlink" title="Action event 的處理"></a>Action event 的處理</h2><p>由於 UserId 已經事先取得了，這些 event 的處理請依服務的內容去實作可能是做記錄或回覆訊息，就不提供範例。</p>
<h3 id="Follow-event"><a href="#Follow-event" class="headerlink" title="Follow event"></a>Follow event</h3><p>LINE@ 帳號被加為好友得到通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case EventType.Follow:</div><div class="line">    // HandleFollowEvent</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Unfollow-event"><a href="#Unfollow-event" class="headerlink" title="Unfollow event"></a>Unfollow event</h3><p>LINE@ 帳號被封鎖時得到通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case EventType.Unfollow:</div><div class="line">    // HandleUnfollowEvent</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Join-event"><a href="#Join-event" class="headerlink" title="Join event"></a>Join event</h3><p>LINE@ 帳號被加入群組或聊天室時得到通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case EventType.Join:</div><div class="line">    // HandleJoinEvent</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Leave-event"><a href="#Leave-event" class="headerlink" title="Leave event"></a>Leave event</h3><p>LINE@ 帳號離開群組時得到通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case EventType.Leave :</div><div class="line">    // HandleLeaveEvent</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Postback-event"><a href="#Postback-event" class="headerlink" title="Postback event"></a>Postback event</h3><p>當好友從 template message 中 觸發 Postback Action，收到送來的參數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">case EventType.Postback :</div><div class="line">    // HandlePostbackEvent</div><div class="line">    var postbackReplyMessage = new TextMessage(lineEvent.Postback.Data);</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h3 id="Beacon-event"><a href="#Beacon-event" class="headerlink" title="Beacon event"></a>Beacon event</h3><p>當好友進入或離開 LINE Beacon 的區域時得到通知</p>
<h4 id="什麼是-LINE-Beacon-服務？"><a href="#什麼是-LINE-Beacon-服務？" class="headerlink" title="什麼是 LINE Beacon 服務？"></a>什麼是 LINE Beacon 服務？</h4><p>當進入或離開 LINE Beacon 的區域時，官方帳號將會透過 LINE 傳送商家設置的 Beacon 發訊機（藍牙發射器）所發出的優惠、特價資訊，或是特別情報給您。(參考4)</p>
<p>現在只在少數特定的地方有這個設置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case EventType.Beacon :</div><div class="line">    // HandleBeaconEvent</div><div class="line">    break;</div></pre></td></tr></table></figure>
<h2 id="完整範例"><a href="#完整範例" class="headerlink" title="完整範例"></a>完整範例</h2><p>最後，把上面的全部內容組織起來，提供一個簡單的範例。由於只是為了示範，就沒有多做設計，全部放到一個 Controller 裡做呈現。</p>
<p>如果是實際應用，事件處理、回覆的訊息單元及商務流程的實作是有很多可以設計的地方，以符合程式碼品質原則。</p>
<p>範例的情境很簡單：</p>
<ul>
<li><p>輸入特定的功能名稱會呈現該功能的內容：<br>“buttons”, “confirm”, “carousel”, “imagemap”，<br>懶得記也懶的打，就輸入 “demo”，會顯示 buttons 選單出來用選的。</p>
</li>
<li><p>傳送多媒體檔案，會回一張 GitHub 的圖。</p>
</li>
<li><p>傳送位置訊息，會回相同的位置訊息。</p>
</li>
<li><p>輸入其它的內容，就會用原本的內容回覆。</p>
</li>
</ul>
<script src="https://gist.github.com/yingclin/54762ca213cd8a9807555f0a08930543.js"></script>

<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>LINE 在台灣有很高的使用率，LINE BOT 開發也很容易入手，所以 LINE BOT 本地應用持續增加，開發人員值得一學。</p>
<p>但在國際上佔有率不高的情況下，像是 <a href="https://dev.botframework.com/" title="Microsoft Bot Framework" target="_blank" rel="external">Microsoft Bot Framework</a>、<a href="https://recime.io/" title="recime.io" target="_blank" rel="external">recime</a> 等通用 BOT 平台大都尚未支援，少了後勤支援，開發上只能孤軍奮戰自己找資源做整合。</p>
<h2 id="參考資料及圖片來源"><a href="#參考資料及圖片來源" class="headerlink" title="參考資料及圖片來源"></a>參考資料及圖片來源</h2><ol>
<li><a href="https://www.slideshare.net/linecorp/a-1-opening-introduction?ref=http://linedevday.linecorp.com/jp/2016/" target="_blank" rel="external">LINE Developer Day 2016 - Opening &amp; Introduction</a>  </li>
<li><a href="https://business.line.me/zh-hant/services/bot" target="_blank" rel="external">LINE business center - Messaging API</a>  </li>
<li><a href="http://at-blog.line.me/tw/messaging_api_intro" target="_blank" rel="external">LINE Blog - 【功能介紹】Messaging API</a></li>
<li><a href="https://help.line.me/line/android/categoryId/50000502/2/sp?lang=zh-Hant" target="_blank" rel="external">LINE Beacon是什麼樣的服務呢？</a>  </li>
</ol>
<!-- ref link -->
</div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a data-url="https://yingclin.github.io/2017/asp-net-line-messaging-api-basic.html" data-id="cjkdn3l3l0024fkp8lydfu317" class="article-share-link">分享至</a><div class="tags"><a href="/tags/ASP-NET/">ASP.NET</a><a href="/tags/Web-API/">Web API</a><a href="/tags/bot/">bot</a><a href="/tags/LINE/">LINE</a></div><div class="post-nav"><a href="/2017/2017-taipei-fisu-broadcast.html" class="pre">2017 台北世大運 線上直播</a><a href="/2017/asp-net-web-api-restful-best-practice-3.html" class="next">ASP.NET Web API 最佳實踐專案整合 - 客製篇</a></div><div id="disqus_thread"><script>var disqus_shortname = 'ycl-breadcrumbs';
var disqus_identifier = '2017/asp-net-line-messaging-api-basic.html';
var disqus_title = '以 ASP.NET Web API 開發 LINE BOT - LINE Messaging API 詳解';
var disqus_url = 'https://yingclin.github.io/2017/asp-net-line-messaging-api-basic.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ycl-breadcrumbs.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://yingclin.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> <span class="widget_font"> 分類</span></i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/construction/">軟體構建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/outdoor/">野日子</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> <span class="widget_font"> 標籤</span></i></div><div class="tagcloud"><a href="/tags/RESTFul/" style="font-size: 15px;">RESTFul</a> <a href="/tags/ASP-NET-Core/" style="font-size: 15px;">ASP.NET Core</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/NuGet/" style="font-size: 15px;">NuGet</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/ASP-NET/" style="font-size: 15px;">ASP.NET</a> <a href="/tags/MVC/" style="font-size: 15px;">MVC</a> <a href="/tags/C/" style="font-size: 15px;">C#</a> <a href="/tags/小抄/" style="font-size: 15px;">小抄</a> <a href="/tags/NET-Core/" style="font-size: 15px;">.NET Core</a> <a href="/tags/API/" style="font-size: 15px;">API</a> <a href="/tags/Web-API/" style="font-size: 15px;">Web API</a> <a href="/tags/運動會/" style="font-size: 15px;">運動會</a> <a href="/tags/Windows-10/" style="font-size: 15px;">Windows 10</a> <a href="/tags/Visual-Studio/" style="font-size: 15px;">Visual Studio</a> <a href="/tags/bot/" style="font-size: 15px;">bot</a> <a href="/tags/LINE/" style="font-size: 15px;">LINE</a> <a href="/tags/NET/" style="font-size: 15px;">.NET</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"><span class="widget_font"> 最新文章</span></i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/simple-react-starter-page.html">簡單的 React 練習頁</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/create-nuget-package-multi-projects.html">建立多專案組成的 NuGet 套件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/build-private-nuget-server.html">使用 NuGet.Server 架設私有的 NuGet 伺服器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/create-nuget-package.html">由類別庫建立 NuGet 套件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/using-csharp-6-7-with-mvc-5.html">[小抄] 在 ASP.NET MVC 5 的 View 中使用 C# 6 或 C# 7 語法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/aspnetcode-2.0-toturial.html">ASP.NET Core 2.0 開發入門</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/windows-10-vs-old-projects-tips.html">新 Windows 10 對上 ASP.NET 舊專案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/net-code-2-introduction.html">準備就緒的 .NET Core 2.0 來了</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/2017-taipei-fisu-broadcast.html">2017 台北世大運 線上直播</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/asp-net-line-messaging-api-basic.html">以 ASP.NET Web API 開發 LINE BOT - LINE Messaging API 詳解</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">想不起來而已.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.1"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-67006685-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>